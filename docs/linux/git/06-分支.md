# åˆ†æ”¯ç®¡ç†

## åˆ›å»ºä¸åˆå¹¶åˆ†æ”¯

åœ¨ç‰ˆæœ¬å›é€€é‡Œï¼Œä½ å·²ç»çŸ¥é“ï¼Œæ¯æ¬¡æäº¤ï¼ŒGit éƒ½æŠŠå®ƒä»¬ä¸²æˆä¸€æ¡æ—¶é—´çº¿ï¼Œè¿™æ¡æ—¶é—´çº¿å°±æ˜¯ä¸€ä¸ªåˆ†æ”¯ã€‚æˆªæ­¢åˆ°ç›®å‰ï¼Œåªæœ‰ä¸€æ¡æ—¶é—´çº¿ï¼Œåœ¨ Git é‡Œï¼Œè¿™ä¸ªåˆ†æ”¯å«ä¸»åˆ†æ”¯ï¼Œå³ `master` åˆ†æ”¯ã€‚

`HEAD` ä¸¥æ ¼æ¥è¯´ä¸æ˜¯æŒ‡å‘æäº¤ï¼Œè€Œæ˜¯æŒ‡å‘ `master`ï¼Œ`master` æ‰æ˜¯æŒ‡å‘æäº¤çš„ï¼Œæ‰€ä»¥ï¼Œ`HEAD` æŒ‡å‘çš„å°±æ˜¯å½“å‰åˆ†æ”¯ã€‚

æ‰€æœ‰ä¹Ÿå¯ä»¥æŠŠ `master` åˆ†æ”¯æŠ½è±¡åœ°ç†è§£æˆä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘åœ¨ `master` æäº¤çš„ç‰ˆæœ¬ä¸­æœ€æ–°çš„é‚£ä¸€ä¸ªç‰ˆæœ¬

é™¤äº† `master` åˆ†æ”¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºå…¶ä»–çš„åˆ†æ”¯ï¼Œæ¯”å¦‚ `dev` åˆ†æ”¯ï¼Œå…¶å®è¿™å°±ç›¸å½“äºåˆ›å»ºäº†ä¸€ä¸ª `dev` æŒ‡é’ˆï¼Œå®ƒä¼šæŒ‡å‘åœ¨æ‰€æœ‰ `dev` æäº¤çš„ç‰ˆæœ¬ä¸­æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰ä»»ä½• commitï¼Œå› æ­¤å®ƒä¹Ÿä¼šæŒ‡å‘ `master`

### åˆ›å»ºåˆ†æ”¯

```bash
git checkout -b dev

# Switched to a new branch 'dev'


# -b é€‰é¡¹è¡¨ç¤ºåˆ›å»ºåˆ†æ”¯å¹¶åˆ‡æ¢åˆ°è¯¥åˆ†æ”¯
# git branch dev
# git switch dev / git checkout dev


# æ–°ç‰ˆæœ¬æä¾›äº† git switch -c dev èƒ½å®ç°ä¸€æ ·çš„åŠŸèƒ½

```

ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å½“å‰åˆ†æ”¯

```bash
git branch


# * dev
#   master
```

ç°åœ¨ commit ä¸€æ¬¡ä¿®æ”¹åçš„æ–‡ä»¶, å†åˆ‡æ¢å› master åˆ†æ”¯

```bash
git checkout master
# git switch master
```

æˆ‘ä»¬ä¼šå‘ç°ï¼Œå·¥ä½œåŒºçš„æ–‡ä»¶åˆæ¢å¤å› `master` çš„çŠ¶æ€äº†, å› ä¸ºåˆšåˆšçš„æäº¤æ˜¯åœ¨ `dev` åˆ†æ”¯ä¸‹æäº¤ï¼Œ`master` åˆ†åŒºçš„æäº¤ç‚¹å¹¶æ²¡æœ‰æ”¹å˜

### åˆå¹¶åˆ†æ”¯

ç°åœ¨æˆ‘ä»¬å›åˆ° master åˆ†æ”¯ `git checkout master`

å¦‚æœè¦æŠŠ dev åˆ†æ”¯çš„å·¥ä½œæˆæœåˆå¹¶åˆ° master

```bash
git merge dev

# Updating a11a2e6..18ce4dd
# Fast-forward
#  readme.md | 2 ++
#  1 file changed, 2 insertions(+)
```

è¿™æ¬¡æ“ä½œæŠŠ `master` æŒ‡é’ˆæŒ‡å‘äº† `dev` æŒ‡é’ˆ, ä¸”å·¥ä½œåŒºçš„æ–‡ä»¶ä¹Ÿå˜æˆäº†åœ¨ `dev` é‡Œæäº¤çš„çŠ¶æ€

::: tip
æ³¨æ„åˆ°ä¸Šé¢çš„ `Fast-forward` ä¿¡æ¯ï¼ŒGit å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™æ¬¡åˆå¹¶æ˜¯â€œå¿«è¿›æ¨¡å¼â€ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥æŠŠ `master` æŒ‡å‘ `dev` çš„å½“å‰æäº¤ï¼Œæ‰€ä»¥åˆå¹¶é€Ÿåº¦éå¸¸å¿«ã€‚

å½“ç„¶ï¼Œä¹Ÿä¸æ˜¯æ¯æ¬¡åˆå¹¶éƒ½èƒ½ `Fast-forward`ï¼Œæˆ‘ä»¬åé¢ä¼šè®²å…¶ä»–æ–¹å¼çš„åˆå¹¶ã€‚
:::

åˆå¹¶å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥åˆ é™¤æ‰ dev åˆ†æ”¯

```bash
git branch -d dev

# Deleted branch dev (was 18ce4dd).
```

å†ä½¿ç”¨ `git branch` æŸ¥çœ‹ï¼Œå‘ç°åªå‰©ä¸‹ `master` åˆ†æ”¯äº†

> å› ä¸ºåˆ›å»ºã€åˆå¹¶å’Œåˆ é™¤åˆ†æ”¯éå¸¸å¿«ï¼Œæ‰€ä»¥ Git é¼“åŠ±ä½ ä½¿ç”¨åˆ†æ”¯å®ŒæˆæŸä¸ªä»»åŠ¡ï¼Œåˆå¹¶åå†åˆ æ‰åˆ†æ”¯ï¼Œè¿™å’Œç›´æ¥åœ¨ master åˆ†æ”¯ä¸Šå·¥ä½œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œä½†è¿‡ç¨‹æ›´å®‰å…¨ã€‚

## è§£å†³å†²çª

ç„¶è€Œåœ¨å®é™…æƒ…å†µä¸­åˆå¹¶åˆ†æ”¯éƒ½ä¸ä¼šæ˜¯é¡ºåˆ©çš„ã€‚

ç°åœ¨æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª `merge conflict`

```bash
git switch -c feature

# vim readme.md è¿™æ­¥æ“ä½œæŠŠä»»æ„ä¸€è¡Œå†…å®¹æ”¹åŠ¨


git commit -am 'feature change a line'

# æäº¤


git branch master

# æŠŠåŒä¸€è¡Œæ”¹æˆä¸åŒçš„å†…å®¹


git commit -am 'master change a line'

# æäº¤

```

æŠŠ dev åˆ†æ”¯åˆå¹¶åˆ° master

```bash
git merge dev

# Auto-merging readme.md
# CONFLICT (content): Merge conflict in readme.md
# Automatic merge failed; fix conflicts and then commit the result.
```

ç°åœ¨å†²çªå‘ç”Ÿäº†,merge å¤±è´¥, git è¿›å…¥äº† merge æ¨¡å¼ï¼Œæ–‡ä»¶è¢«æ”¹æˆäº†è¿™æ ·

```text
<<<<<<< HEAD
nqhuqhn
=======
nsqyushuqhns yqusqwuy uy
>>>>>>> dev
```

æ˜¾ç¤ºå‡ºä¸åŒåˆ†æ”¯çš„å†²çªå†…å®¹

ç°åœ¨æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š

1. è¾“å…¥`git status`ï¼Œgit ä¼šæç¤ºæˆ‘ä»¬ä½¿ç”¨ `git merge --abort` æ’¤é”€ merge æ“ä½œ
2. ç›´æ¥ä¿®æ”¹æ–‡ä»¶å†²çªçš„ä½ç½®ï¼Œæ”¹æˆæˆ‘ä»¬æƒ³è¦çš„å†…å®¹ï¼Œå† add åæäº¤

å¦‚æœä½ è§£å†³äº†å†²çªï¼Œç°åœ¨ä½¿ç”¨`git log --graph` å°±å¯ä»¥çœ‹åˆ°åˆ†æ”¯çš„åˆå¹¶å›¾

## åˆ†æ”¯ç®¡ç†ç­–ç•¥

é€šå¸¸åˆå¹¶åˆ†æ”¯æ—¶ï¼Œå¦‚æœå¯èƒ½ï¼Œgit ä¼šç”¨`Fast forward` æ¨¡å¼,ä½†è¿™ç§æ¨¡å¼ä¸‹ï¼Œåˆ é™¤åˆ†æ”¯åï¼Œä¼šä¸¢æ‰åˆ†æ”¯ä¿¡æ¯ã€‚

å¦‚æœè¦å¼ºåˆ¶ç¦ç”¨ Fast forward æ¨¡å¼ï¼ŒGit å°±ä¼šåœ¨ merge æ—¶ç”Ÿæˆä¸€ä¸ªæ–°çš„ commitï¼Œè¿™æ ·ï¼Œä»åˆ†æ”¯å†å²ä¸Šå°±å¯ä»¥çœ‹å‡ºåˆ†æ”¯ä¿¡æ¯ã€‚

ä½¿ç”¨`--no-ff`æ–¹å¼çš„`git merge`å³å¯ï¼š

```bash
git merge --no-ff -m "merge with no-ff" dev
```

å› ä¸ºæœ¬æ¬¡åˆå¹¶è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ commitï¼Œæ‰€ä»¥åŠ ä¸Š-m å‚æ•°ï¼ŒæŠŠ commit æè¿°å†™è¿›å»ã€‚

åˆå¹¶å, ä½¿ç”¨ `git log` æŸ¥çœ‹åˆ†æ”¯å†å²

### åˆ†æ”¯ç­–ç•¥

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥æŒ‰ç…§å‡ ä¸ªåŸºæœ¬åŸåˆ™è¿›è¡Œåˆ†æ”¯ç®¡ç†ï¼š

é¦–å…ˆï¼Œmaster åˆ†æ”¯åº”è¯¥æ˜¯éå¸¸ç¨³å®šçš„ï¼Œä¹Ÿå°±æ˜¯ä»…ç”¨æ¥å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œå¹³æ—¶ä¸èƒ½åœ¨ä¸Šé¢å¹²æ´»ï¼›

é‚£åœ¨å“ªå¹²æ´»å‘¢ï¼Ÿå¹²æ´»éƒ½åœ¨ dev åˆ†æ”¯ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œdev åˆ†æ”¯æ˜¯ä¸ç¨³å®šçš„ï¼Œåˆ°æŸä¸ªæ—¶å€™ï¼Œæ¯”å¦‚ 1.0 ç‰ˆæœ¬å‘å¸ƒæ—¶ï¼Œå†æŠŠ dev åˆ†æ”¯åˆå¹¶åˆ° master ä¸Šï¼Œåœ¨ master åˆ†æ”¯å‘å¸ƒ 1.0 ç‰ˆæœ¬ï¼›

ä½ å’Œä½ çš„å°ä¼™ä¼´ä»¬æ¯ä¸ªäººéƒ½åœ¨ dev åˆ†æ”¯ä¸Šå¹²æ´»ï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„åˆ†æ”¯ï¼Œæ—¶ä¸æ—¶åœ°å¾€ dev åˆ†æ”¯ä¸Šåˆå¹¶å°±å¯ä»¥äº†ã€‚

æ‰€ä»¥ï¼Œå›¢é˜Ÿåˆä½œçš„åˆ†æ”¯çœ‹èµ·æ¥å°±åƒè¿™æ ·ï¼š

![img](https://user-images.githubusercontent.com/94043894/197506742-f6f8cde3-54f4-4f97-a6fc-c3c506803302.png)

## Stash

è½¯ä»¶å¼€å‘ä¸­ï¼Œbug å°±åƒå®¶å¸¸ä¾¿é¥­ä¸€æ ·ã€‚æœ‰äº† bug å°±éœ€è¦ä¿®å¤ï¼Œåœ¨ Git ä¸­ï¼Œç”±äºåˆ†æ”¯æ˜¯å¦‚æ­¤çš„å¼ºå¤§ï¼Œæ‰€ä»¥ï¼Œæ¯ä¸ª bug éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªæ–°çš„ä¸´æ—¶åˆ†æ”¯æ¥ä¿®å¤ï¼Œä¿®å¤åï¼Œåˆå¹¶åˆ†æ”¯ï¼Œç„¶åå°†ä¸´æ—¶åˆ†æ”¯åˆ é™¤ã€‚

å½“ä½ æ¥åˆ°ä¸€ä¸ªä¿®å¤ä¸€ä¸ªä»£å· 101 çš„ bug çš„ä»»åŠ¡æ—¶ï¼Œå¾ˆè‡ªç„¶åœ°ï¼Œä½ æƒ³åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ `issue-101` æ¥ä¿®å¤å®ƒï¼Œä½†æ˜¯ï¼Œç­‰ç­‰ï¼Œå½“å‰æ­£åœ¨ `dev` ä¸Šè¿›è¡Œçš„å·¥ä½œè¿˜æ²¡æœ‰æäº¤ï¼š

å¹¶ä¸æ˜¯ä½ ä¸æƒ³æäº¤ï¼Œè€Œæ˜¯å·¥ä½œåªè¿›è¡Œåˆ°ä¸€åŠï¼Œè¿˜æ²¡æ³•æäº¤ï¼Œé¢„è®¡å®Œæˆè¿˜éœ€ 1 å¤©æ—¶é—´ã€‚ä½†æ˜¯ï¼Œå¿…é¡»åœ¨ä¸¤ä¸ªå°æ—¶å†…ä¿®å¤è¯¥ bugï¼Œæ€ä¹ˆåŠï¼Ÿ

å¹¸å¥½ï¼ŒGit è¿˜æä¾›äº†ä¸€ä¸ª stash åŠŸèƒ½ï¼Œå¯ä»¥æŠŠå½“å‰å·¥ä½œç°åœºâ€œå‚¨è—â€èµ·æ¥ï¼Œç­‰ä»¥åæ¢å¤ç°åœºåç»§ç»­å·¥ä½œï¼š

ç°åœ¨ï¼Œç”¨ `git status` æŸ¥çœ‹å·¥ä½œåŒºï¼Œå°±æ˜¯å¹²å‡€çš„ï¼ˆé™¤éæœ‰æ²¡æœ‰è¢« Git ç®¡ç†çš„æ–‡ä»¶ï¼‰ï¼Œå› æ­¤å¯ä»¥æ”¾å¿ƒåœ°åˆ›å»ºåˆ†æ”¯æ¥ä¿®å¤ bugã€‚

é¦–å…ˆç¡®å®šè¦åœ¨å“ªä¸ªåˆ†æ”¯ä¸Šä¿®å¤ bugï¼Œå‡å®šéœ€è¦åœ¨ `master` åˆ†æ”¯ä¸Šä¿®å¤ï¼Œå°±ä» `master` åˆ›å»ºä¸´æ—¶åˆ†æ”¯ï¼š

```bash
git checkout master
# Switched to branch 'master'
# Your branch is ahead of 'origin/master' by 6 commits.
#   (use "git push" to publish your local commits)

git checkout -b issue-101
# Switched to a new branch 'issue-101'
```

ä¿®å¤å®Œæˆ, æäº¤åï¼Œå¼€å§‹åˆå¹¶åˆ†æ”¯

```bash
git switch master
# Switched to branch 'master'
# Your branch is ahead of 'origin/master' by 6 commits.
#   (use "git push" to publish your local commits)

git merge --no-ff -m "merged bug fix 101" issue-101
# Merge made by the 'recursive' strategy.
#  readme.txt | 2 +-
#  1 file changed, 1 insertion(+), 1 deletion(-)
```

ç°åœ¨ï¼Œæ˜¯æ—¶å€™æ¥ç€å›åˆ° dev åˆ†æ”¯å¹²æ´»äº†ï¼

```bash
git switch dev

git status
# On branch dev
# nothing to commit, working tree clean
# åˆ‡æ¢å› dev åˆ†æ”¯ï¼Œå·¥ä½œåŒºæ˜¯å¹²å‡€çš„


git stash list
# stash@{0}: WIP on dev: f52c633 add merge
# æŸ¥çœ‹ stash çŠ¶æ€ï¼Œåˆšåˆšå·¥ä½œåŒºçš„çŠ¶æ€å‚¨å­˜åœ¨äº†è¿™é‡Œ
```

æœ‰ä¸¤ç§æ¢å¤æ–¹æ³•:

1. `git stash apply` æ˜¯æ¢å¤åï¼Œstash å†…å®¹å¹¶ä¸åˆ é™¤ï¼Œä½ éœ€è¦ç”¨ `git stash drop` æ¥åˆ é™¤
2. å¦ä¸€ç§æ–¹å¼æ˜¯ç”¨`git stash pop`ï¼Œæ¢å¤çš„åŒæ—¶æŠŠ stash å†…å®¹ä¹Ÿåˆ äº†

::: tip
å¯ä»¥å¤šæ¬¡ stashï¼Œæ¢å¤çš„æ—¶å€™ï¼Œå…ˆç”¨ `git stash list` æŸ¥çœ‹ï¼Œç„¶åæ¢å¤æŒ‡å®šçš„ stashï¼Œç”¨å‘½ä»¤ï¼š
`git stash apply stash@{0}`
:::

## Cherry-pick

åœ¨ `master` åˆ†æ”¯ä¸Šä¿®å¤äº† bug åï¼Œæˆ‘ä»¬è¦æƒ³ä¸€æƒ³ï¼Œ`dev` åˆ†æ”¯æ˜¯æ—©æœŸä» `master` åˆ†æ”¯åˆ†å‡ºæ¥çš„ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ª bug å…¶å®åœ¨å½“å‰ `dev` åˆ†æ”¯ä¸Šä¹Ÿå­˜åœ¨ã€‚

åŒæ ·çš„ bugï¼Œè¦åœ¨ `dev` ä¸Šä¿®å¤ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠ `4c805e2 fix bug 101` è¿™ä¸ªæäº¤æ‰€åšçš„ä¿®æ”¹â€œå¤åˆ¶â€åˆ° `dev` åˆ†æ”¯ã€‚æ³¨æ„ï¼šæˆ‘ä»¬åªæƒ³å¤åˆ¶ `4c805e2 fix bug 101` è¿™ä¸ªæäº¤æ‰€åšçš„ä¿®æ”¹ï¼Œå¹¶ä¸æ˜¯æŠŠæ•´ä¸ª `master` åˆ†æ”¯ merge è¿‡æ¥ã€‚

ä¸ºäº†æ–¹ä¾¿æ“ä½œï¼ŒGit ä¸“é—¨æä¾›äº†ä¸€ä¸ª `cherry-pick` å‘½ä»¤ï¼Œè®©æˆ‘ä»¬èƒ½å¤åˆ¶ä¸€ä¸ªç‰¹å®šçš„æäº¤åˆ°å½“å‰åˆ†æ”¯ï¼š

```bash
git branch
# * dev
#   master
git cherry-pick 4c805e2
# [master 1d4b803] fix bug 101
#  1 file changed, 1 insertion(+), 1 deletion(-)
```

Git è‡ªåŠ¨ç»™ dev åˆ†æ”¯åšäº†ä¸€æ¬¡æäº¤ï¼Œæ³¨æ„è¿™æ¬¡æäº¤çš„ commit æ˜¯ `1d4b803`ï¼Œå®ƒå¹¶ä¸åŒäº master çš„ `4c805e2`ï¼Œå› ä¸ºè¿™ä¸¤ä¸ª commit åªæ˜¯æ”¹åŠ¨ç›¸åŒï¼Œä½†ç¡®å®æ˜¯ä¸¤ä¸ªä¸åŒçš„ commitã€‚ç”¨ `git cherry-pick`ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åœ¨ dev åˆ†æ”¯ä¸Šæ‰‹åŠ¨å†æŠŠä¿® bug çš„è¿‡ç¨‹é‡å¤ä¸€éã€‚

## Feature

è½¯ä»¶å¼€å‘ä¸­ï¼Œæ€»æœ‰æ— ç©·æ— å°½çš„æ–°çš„åŠŸèƒ½è¦ä¸æ–­æ·»åŠ è¿›æ¥ã€‚

æ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½æ—¶ï¼Œä½ è‚¯å®šä¸å¸Œæœ›å› ä¸ºä¸€äº›å®éªŒæ€§è´¨çš„ä»£ç ï¼ŒæŠŠä¸»åˆ†æ”¯æä¹±äº†ï¼Œæ‰€ä»¥ï¼Œæ¯æ·»åŠ ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œæœ€å¥½æ–°å»ºä¸€ä¸ª `feature` åˆ†æ”¯ï¼Œåœ¨ä¸Šé¢å¼€å‘ï¼Œå®Œæˆåï¼Œåˆå¹¶ï¼Œæœ€åï¼Œåˆ é™¤è¯¥ `feature` åˆ†æ”¯ã€‚

å¦‚æœä½ å¼€å‘åˆ°ä¸€åŠ, å‘ç°åˆä¸éœ€è¦æ–°åŠŸèƒ½ï¼Œéœ€è¦åˆ é™¤ `feature` åˆ†æ”¯

å¦‚æœè¦ä¸¢å¼ƒä¸€ä¸ªæ²¡æœ‰è¢«åˆå¹¶è¿‡çš„åˆ†æ”¯ï¼Œå¯ä»¥é€šè¿‡ `git branch -D <name>`å¼ºè¡Œåˆ é™¤ã€‚

## å¤šäººåä½œ

å½“ä½ ä»è¿œç¨‹ä»“åº“å…‹éš†æ—¶ï¼Œå®é™…ä¸Š Git è‡ªåŠ¨æŠŠæœ¬åœ°çš„ `master` åˆ†æ”¯å’Œè¿œç¨‹çš„ `master` åˆ†æ”¯å¯¹åº”èµ·æ¥äº†ï¼Œå¹¶ä¸”ï¼Œè¿œç¨‹ä»“åº“çš„é»˜è®¤åç§°æ˜¯ originã€‚

è¦æŸ¥çœ‹è¿œç¨‹åº“çš„ä¿¡æ¯ï¼Œç”¨ git remoteï¼š

```bash
git remote
# origin
```

æˆ–è€…ä½¿ç”¨ `git remote -v`æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯ï¼š

```bash
git remote -v
# origin  git@github.com:michaelliao/learngit.git (fetch)
# origin  git@github.com:michaelliao/learngit.git (push)
```

> ä¸Šé¢æ˜¾ç¤ºäº†å¯ä»¥æŠ“å–å’Œæ¨é€çš„ origin çš„åœ°å€ã€‚å¦‚æœæ²¡æœ‰æ¨é€æƒé™ï¼Œå°±çœ‹ä¸åˆ° push çš„åœ°å€ã€‚

### æ¨é€åˆ†æ”¯

æ¨é€åˆ†æ”¯ï¼Œå°±æ˜¯æŠŠè¯¥åˆ†æ”¯ä¸Šçš„æ‰€æœ‰æœ¬åœ°æäº¤æ¨é€åˆ°è¿œç¨‹åº“ã€‚æ¨é€æ—¶ï¼Œè¦æŒ‡å®šæœ¬åœ°åˆ†æ”¯ï¼Œè¿™æ ·ï¼ŒGit å°±ä¼šæŠŠè¯¥åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹åº“å¯¹åº”çš„è¿œç¨‹åˆ†æ”¯ä¸Šï¼š

`git push origin master`

å¦‚æœè¦æ¨é€å…¶ä»–åˆ†æ”¯ï¼Œæ¯”å¦‚`dev`ï¼Œå°±æ”¹æˆï¼š

`git push origin dev`

ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯ä¸€å®šè¦æŠŠæœ¬åœ°åˆ†æ”¯å¾€è¿œç¨‹æ¨é€ï¼Œé‚£ä¹ˆï¼Œå“ªäº›åˆ†æ”¯éœ€è¦æ¨é€ï¼Œå“ªäº›ä¸éœ€è¦å‘¢ï¼Ÿ

- `master` åˆ†æ”¯æ˜¯ä¸»åˆ†æ”¯ï¼Œå› æ­¤è¦æ—¶åˆ»ä¸è¿œç¨‹åŒæ­¥ï¼›

- `dev` åˆ†æ”¯æ˜¯å¼€å‘åˆ†æ”¯ï¼Œå›¢é˜Ÿæ‰€æœ‰æˆå‘˜éƒ½éœ€è¦åœ¨ä¸Šé¢å·¥ä½œï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦ä¸è¿œç¨‹åŒæ­¥ï¼›

- `bug` åˆ†æ”¯åªç”¨äºåœ¨æœ¬åœ°ä¿®å¤ `bug`ï¼Œå°±æ²¡å¿…è¦æ¨åˆ°è¿œç¨‹äº†ï¼Œé™¤éè€æ¿è¦çœ‹çœ‹ä½ æ¯å‘¨åˆ°åº•ä¿®å¤äº†å‡ ä¸ª bugï¼›

- `feature` åˆ†æ”¯æ˜¯å¦æ¨åˆ°è¿œç¨‹ï¼Œå–å†³äºä½ æ˜¯å¦å’Œä½ çš„å°ä¼™ä¼´åˆä½œåœ¨ä¸Šé¢å¼€å‘ã€‚

æ€»ä¹‹ï¼Œå°±æ˜¯åœ¨ Git ä¸­ï¼Œåˆ†æ”¯å®Œå…¨å¯ä»¥åœ¨æœ¬åœ°è‡ªå·±è—ç€ç©ï¼Œæ˜¯å¦æ¨é€ï¼Œè§†ä½ çš„å¿ƒæƒ…è€Œå®šï¼

### æŠ“å–åˆ†æ”¯

å¤šäººåä½œæ—¶ï¼Œå¤§å®¶éƒ½ä¼šå¾€ master å’Œ dev åˆ†æ”¯ä¸Šæ¨é€å„è‡ªçš„ä¿®æ”¹ã€‚

ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨ `dev` ä¸Šå¼€å‘ï¼Œå°±å¿…é¡»åˆ›å»ºè¿œç¨‹`origin`çš„`dev` åˆ†æ”¯åˆ°æœ¬åœ°ï¼š

```bash
git checkout -b dev origin/dev


# åå­—æœ€å¥½å’Œè¿œç¨‹ä»“åº“çš„ä¸€æ ·
```

ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨ dev ä¸Šç»§ç»­ä¿®æ”¹

å‡è®¾åŒæ—¶æœ‰å¦ä¸€ä¸ªäººä¹Ÿåœ¨ä»–æœ¬åœ°åˆ›å»ºäº† dev åˆ†æ”¯ï¼Œå¹¶ä¸”å…ˆä½ ä¸€æ­¥`push` åˆ°è¿œç¨‹

ç°åœ¨ä½ å®Œæˆäº†ä½ çš„ä»»åŠ¡,ä¹Ÿéœ€è¦ `push` åˆ°è¿œç¨‹

```bash
git push origin dev
# To github.com:michaelliao/learngit.git
#  ! [rejected]        dev -> dev (non-fast-forward)
# error: failed to push some refs to 'git@github.com:michaelliao/learngit.git'
# hint: Updates were rejected because the tip of your current branch is behind
# hint: its remote counterpart. Integrate the remote changes (e.g.
# hint: 'git pull ...') before pushing again.
# hint: See the 'Note about fast-forwards' in 'git push --help' for details.
```

æ¨é€å¤±è´¥, å› ä¸ºç°åœ¨`dev`çš„æœ€æ–°æäº¤å’Œä½ è¯•å›¾æ¨é€çš„æäº¤æœ‰å†²çªï¼Œè§£å†³åŠæ³•ä¹Ÿå¾ˆç®€å•ï¼ŒGit å·²ç»æç¤ºæˆ‘ä»¬ï¼Œå…ˆç”¨ `git pull` æŠŠæœ€æ–°çš„æäº¤ä» `origin/dev` æŠ“ä¸‹æ¥ï¼Œç„¶åï¼Œåœ¨æœ¬åœ°åˆå¹¶ï¼Œè§£å†³å†²çªï¼Œå†æ¨é€ï¼š

```bash
git pull
# There is no tracking information for the current branch.
# Please specify which branch you want to merge with.
# See git-pull(1) for details.
#
#     git pull <remote> <branch>
#
# If you wish to set tracking information for this branch you can do so with:
#
#     git branch --set-upstream-to=origin/<branch> dev
```

`git pull`ä¹Ÿå¤±è´¥äº†ï¼ŒåŸå› æ˜¯æ²¡æœ‰æŒ‡å®šæœ¬åœ°`dev`åˆ†æ”¯ä¸è¿œç¨‹`origin/dev`åˆ†æ”¯çš„é“¾æ¥ï¼Œæ ¹æ®æç¤ºï¼Œè®¾ç½®`dev`å’Œ`origin/dev`çš„é“¾æ¥,å†æ¬¡ `pull`ï¼š

```bash
git branch --set-upstream-to=origin/dev dev
# Branch 'dev' set up to track remote branch 'dev' from 'origin'.

git pull
# Auto-merging env.txt
# CONFLICT (add/add): Merge conflict in env.txt
# Automatic merge failed; fix conflicts and then commit the result.
```

è¿™å› `git pull` æˆåŠŸï¼Œä½†æ˜¯åˆå¹¶æœ‰å†²çªï¼Œéœ€è¦æ‰‹åŠ¨è§£å†³ï¼Œè§£å†³çš„æ–¹æ³•å’Œåˆ†æ”¯ç®¡ç†ä¸­çš„è§£å†³å†²çªå®Œå…¨ä¸€æ ·ã€‚è§£å†³åï¼Œæäº¤ï¼Œå† `push`ï¼š

```bash
git commit -m "fix env conflict"
# [dev 57c53ab] fix env conflict
#
# $ git push origin dev
# Counting objects: 6, done.
# Delta compression using up to 4 threads.
# Compressing objects: 100% (4/4), done.
#     Writing objects: 100% (6/6), 621 bytes | 621.00 KiB/s, done.
# Total 6 (delta 0), reused 0 (delta 0)
#     To github.com:michaelliao/learngit.git
#     7a5e5dd..57c53ab  dev -> dev
```

## Rebase

### åˆå¹¶å†²çª

åœ¨ä¸Šä¸€èŠ‚æˆ‘ä»¬çœ‹åˆ°äº†ï¼Œå¤šäººåœ¨åŒä¸€ä¸ªåˆ†æ”¯ä¸Šåä½œæ—¶ï¼Œå¾ˆå®¹æ˜“å‡ºç°å†²çªã€‚å³ä½¿æ²¡æœ‰å†²çªï¼Œå push çš„ç«¥é‹ä¸å¾—ä¸å…ˆ pullï¼Œåœ¨æœ¬åœ°åˆå¹¶ï¼Œç„¶åæ‰èƒ½ push æˆåŠŸã€‚

æ¯æ¬¡åˆå¹¶å† push åï¼Œåˆ†æ”¯å˜æˆäº†è¿™æ ·ï¼š

```bash
git log --graph --pretty=oneline --abbrev-commit
# * d1be385 (HEAD -> master, origin/master) init hello
# *   e5e69f1 Merge branch 'dev'
# |\
# | *   57c53ab (origin/dev, dev) fix env conflict
# | |\
# | | * 7a5e5dd add env
# | * | 7bd91f1 add new env
# | |/
# * |   12a631b merged bug fix 101
# |\ \
# | * | 4c805e2 fix bug 101
# |/ /
# * |   e1e9c68 merge with no-ff
# |\ \
# | |/
# | * f52c633 add merge
# |/
# *   cf810e4 conflict fixed
```

```bash
# æ¯”å¦‚ä½ å’Œå°ä¼™ä¼´éƒ½ä»Aåˆ›å»ºäº†ä¸€ä¸ªæ–°åˆ†æ”¯Bä¸Cï¼Œä½ è¿˜åœ¨å¼€å‘ï¼Œä½†æ˜¯å°ä¼™ä¼´å·²ç»å¼€å‘å®Œæ¯•ï¼Œå¹¶ä¸”mergeåˆ°äº†A
# A --> B
# |--> C -->A`

# é‚£ä¹ˆä½ å¼€å‘å®Œæ¯•åï¼Œæƒ³è¦æäº¤ï¼Œä½†æ˜¯Aå·²ç»é¢†å…ˆBä¸€ä¸ªç‰ˆæœ¬äº†ï¼Œ
# æ‰§è¡Œ (åœ¨Båˆ†æ”¯) git merge A`
# A --> B --> A``
# |           |
# |--> C -->A`
```

ä½†æ˜¯ï¼Œè¿™äº›åˆå¹¶çš„è®°å½•æ˜¯å®Œå…¨æ— æ•ˆçš„ä¿¡æ¯ï¼Œé‚£ä¹ˆç”¨ rebase å°±å¯ä»¥è¾¾åˆ°ä¼˜é›…çš„ç›´çº¿è®°å½•ã€‚

```bash
# æ¯”å¦‚
# A   (C)     (B)
# |--> A` --> A``
# å¦‚ä½•å®ç°å‘¢ï¼Ÿ
# è¿”å›åˆ°è¿™ä¸ªæ­¥éª¤ï¼Œå°ä¼™ä¼´å·²ç»å¼€å‘å®Œæ¯•äº†ï¼Œä½ ä¹Ÿå¼€å‘å®Œäº†ï¼Œå¹¶ä¸”ä»–å·²ç»æäº¤åˆ°äº†A`
# A --> B
# |--> C -->A`
# æ‰§è¡Œ (åœ¨Båˆ†æ”¯) git rebase A (å½“ç„¶å‰ææ˜¯Aå·²ç»æ˜¯pullåçš„ï¼Œå³A`)
# ç°åœ¨ è®°å½•å·²ç»å˜è¿™æ ·äº†ï¼Œéå¸¸ä¼˜é›…
# A --> A` --> A``
```

> rebase æ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿ
> é¦–å…ˆï¼Œgit ä¼šæŠŠ B åˆ†æ”¯é‡Œé¢çš„æ¯ä¸ª commit å–æ¶ˆæ‰ï¼›
> å…¶æ¬¡ï¼ŒæŠŠä¸Šé¢çš„æ“ä½œä¸´æ—¶ä¿å­˜æˆ patch æ–‡ä»¶ï¼Œå­˜åœ¨ .git/rebase ç›®å½•ä¸‹ï¼›
> ç„¶åï¼ŒæŠŠ B åˆ†æ”¯æ›´æ–°åˆ°æœ€æ–°çš„ A åˆ†æ”¯ï¼›
> æœ€åï¼ŒæŠŠä¸Šé¢ä¿å­˜çš„ patch æ–‡ä»¶åº”ç”¨åˆ° B åˆ†æ”¯ä¸Šï¼›

åŸæœ¬åˆ†å‰çš„æäº¤ç°åœ¨å˜æˆä¸€æ¡ç›´çº¿äº†

é€šè¿‡`push`æ“ä½œæŠŠæœ¬åœ°åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹

å†ç”¨`git log`çœ‹çœ‹æ•ˆæœï¼š

```bash
git log --graph --pretty=oneline --abbrev-commit
# * 7e61ed4 (HEAD -> master, origin/master) add author
# * 3611cfe add comment
# * f005ed4 set exit=1
# * d1be385 init hello
# ...
```

è¿œç¨‹åˆ†æ”¯çš„æäº¤å†å²ä¹Ÿæ˜¯ä¸€æ¡ç›´çº¿ã€‚

> åœ¨ rebase çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿè®¸ä¼šå‡ºç°å†²çª conflictã€‚åœ¨è¿™ç§æƒ…å†µï¼Œgit ä¼šåœæ­¢ rebase å¹¶ä¼šè®©ä½ å»è§£å†³å†²çªã€‚åœ¨è§£å†³å®Œå†²çªåï¼Œç”¨ git add å‘½ä»¤å»æ›´æ–°è¿™äº›å†…å®¹ã€‚ å†æ‰§è¡Œ git rebase --continue

::: danger
æ ¹æ®ä¸Šæ–‡æ¥çœ‹ï¼Œgit-rebase å¾ˆå®Œç¾ï¼Œè§£å†³äº†æˆ‘ä»¬çš„ä¸¤ä¸ªé—®é¢˜ï¼š 1.åˆå¹¶ commit è®°å½•ï¼Œä¿æŒåˆ†æ”¯æ•´æ´ï¼› 2.ç›¸æ¯” merge æ¥è¯´ä¼šå‡å°‘åˆ†æ”¯åˆå¹¶çš„è®°å½•ï¼›

ä½†æ˜¯ä¸€åˆ‡çš„å‰ææ˜¯ä½ æ­£åœ¨æ“ä½œçš„åˆ†æ”¯å¿…é¡»æ˜¯ä»…ä»…å­˜åœ¨æœ¬åœ°çš„åˆ†æ”¯ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆä½ æäº¤åˆ°è¿œç¨‹ä»“åº“åï¼Œå®é™…ä¸Šè¿™æ¡åˆ†æ”¯å°±ä¼šæ¶ˆå¤±äº†ã€‚æ²¡é”™ï¼æäº¤çš„å†å²ä¼šä¸è§ã€‚
é‚£åˆæ€ä¹ˆæ ·ï¼Ÿæˆ‘çš„ç›®çš„ä¸å°±æ˜¯è®©è¿œç¨‹ä»“åº“æäº¤è®°å½•çœ‹èµ·æ¥å¥½çœ‹å—ï¼ŸOKï¼Œé‚£ä¹ˆä½ æ˜¯ä¸€ä¸ªå®æ‰“åˆ©å·±ä¸»ä¹‰è€…ï¼Œä½†é—®é¢˜å‡ºç°çš„åœ°æ–¹ä¸åœ¨äºä½ çš„åˆ†æ”¯å’Œè¿œç¨‹ä»“åº“ï¼Œè€Œæ˜¯åœ¨å°ä¼™ä¼´é‚£é‡Œã€‚
å¦‚æœå°ä¼™ä¼´åŒæ—¶ä¹Ÿåœ¨è¿™æ¡åˆ†æ”¯ä¸Šå¼€å‘ï¼Œä»– pull äº† masterï¼Œå¯èƒ½å°±ä¼šä¸¢å¤± commit è®°å½•äº†ã€‚

æ‰€ä»¥ï¼Œä½¿ç”¨ rebase æ“ä½œçš„å‰ææ˜¯ï¼Œæ‰€æœ‰çš„æ“ä½œçš„ commits éƒ½æ²¡æäº¤åˆ°ä»“åº“è¿‡ã€‚
:::

### ç¼–è¾‘ commit ä¿¡æ¯

æœ‰æ—¶å€™ï¼Œä¸ºäº†è®©æˆ‘ä»¬çš„ commit ä¿¡æ¯çœ‹èµ·æ¥å¥½çœ‹ç‚¹æˆ–æ›´æ”¹ä¸€äº›å·²ç»æäº¤çš„ commit ä¿¡æ¯ï¼Œéœ€è¦ä½¿ç”¨ rebase
å»ç¼–è¾‘ã€‚

::: danger
è¯·æ³¨æ„ä½ å¯¹äº commit åšçš„ä»»ä½•æ“ä½œéƒ½æ˜¯æœ‰é£é™©çš„ï¼Œè¯·æ˜ç™½ä½ åœ¨åšä»€ä¹ˆï¼Œæœ€åçš„æƒ…å†µä¼šä¸¢å¤±äº†é‡è¦çš„ commitï¼
(å†çœ‹ä¸€çœ¼ï¼Œå‘ç°æˆ‘åºŸè¯å¥½å¤š ğŸ’©)
:::

å‡å¦‚æˆ‘æƒ³è¦ä¿®æ”¹å‰ 3 ä¸ªç‰ˆæœ¬æäº¤

```bash
# -i è¡¨ç¤ºäº¤äº’æ¨¡å¼ï¼Œä¸‹é¢çš„æŒ‡ä»¤è¾“å…¥åä¼šä½¿ç”¨ç¼–è¾‘å™¨æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬é¡µé¢
git rebase -i HEAD~3
```

```bash
pick 1f19e7c 4
pick 9feca99 Revert "2"
pick f0d40a6 new new 3
pick a7a7a80 add more trash

# Rebase a07f46c..e8d3b22 onto a07f46c (4 commands)
#
# Commands:
# p, pick <commit> = use commit
# r, reword <commit> = use commit, but edit the commit message
# e, edit <commit> = use commit, but stop for amending
# s, squash <commit> = use commit, but meld into previous commit
# f, fixup [-C | -c] <commit> = like "squash" but keep only the previous
#                    commit's log message, unless -C is used, in which case
#                    keep only this commit's message; -c is same as -C but
#                    opens the editor
# x, exec <command> = run command (the rest of the line) using shell
# b, break = stop here (continue rebase later with 'git rebase --continue')
# d, drop <commit> = remove commit
# l, label <label> = label current HEAD with a name
# t, reset <label> = reset HEAD to a label
# m, merge [-C <commit> | -c <commit>] <label> [# <oneline>]
#         create a merge commit using the original merge commit's
#         message (or the oneline, if no original merge commit was
#         specified); use -c <commit> to reword the commit message
# u, update-ref <ref> = track a placeholder for the <ref> to be updated
#                       to this position in the new commits. The <ref> is
#                       updated at the end of the rebase
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
#
```

> å¯ä»¥çœ‹åˆ°ï¼Œè¿™äº› commit è®°å½•æ˜¯å€’åºè¾“å‡ºçš„ï¼Œå’Œ log çœ‹åˆ°çš„é¡ºåºç›¸åï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ
> å› ä¸º rebase æ˜¯ä»ä»¥å‰çš„ commit å¼€å§‹å‘åé€ä¸ªç¼–è¾‘çš„ï¼Œæœ€å…ˆç¼–è¾‘çš„æ”¾åœ¨æœ€ä¸Šé¢ã€‚
>
> ä¸ºä»€ä¹ˆè¦ä»æ—§çš„å¾€å‰ç¼–è¾‘å‘¢ï¼Ÿ
> å› ä¸ºè¿™æ˜¯ä¸€ä¸ªå˜åŸºå‘½ä»¤â€”â€”åœ¨ `HEAD~3..HEAD` èŒƒå›´å†…çš„æ¯ä¸€ä¸ªä¿®æ”¹äº†æäº¤ä¿¡æ¯çš„æäº¤åŠå…¶ æ‰€æœ‰åè£” éƒ½ä¼šè¢«é‡å†™ã€‚

::: warning
ä¸è¦æ¶‰åŠä»»ä½•å·²ç»æ¨é€åˆ°ä¸­å¤®æœåŠ¡å™¨çš„æäº¤â€”â€”è¿™æ ·åšä¼šäº§ç”Ÿä¸€æ¬¡å˜æ›´çš„ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå› è€Œä½¿ä»–äººå›°æƒ‘ã€‚
:::

ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–è¾‘æƒ³è¦æ“ä½œçš„ commit å‰çš„ pick å˜æˆç›¸åº”çš„å•è¯ï¼Œå†ä¿å­˜é€€å‡ºï¼Œgit
å°±ä¼šæŒ‰é¡ºåºæ‰§è¡Œæˆ‘ä»¬çš„ç¼–è¾‘ã€‚

> ç›¸åº”çš„æ“ä½œå·²ç»å†™åœ¨æ³¨é‡Šé‡Œäº†ï¼Œéå¸¸æ–¹ä¾¿ã€‚
> å¦‚æœä½ ä¸å°å¿ƒé€€å‡ºäº† vimï¼Œå¯ä»¥ä½¿ç”¨ git rebase --edit-todo è¿”å›ç»§ç»­ç¼–è¾‘ï¼Œç¼–è¾‘å®Œä¿å­˜ç»§ç»­ git rebase --continue

è¿›å…¥ rebase çš„æ‰§è¡ŒçŠ¶æ€æ—¶ï¼Œè¾“å…¥`git rebase --abort`å¼ºåˆ¶é€€å‡ºï¼Œæˆ–`git rebase
--skip`è·³è¿‡å½“å‰ commit ç»§ç»­å¤„ç†åé¢çš„ commitã€‚

å‡å¦‚æˆ‘ç°åœ¨æƒ³è¦ç¼–è¾‘ a7a7a80 çš„`trash`å•è¯ä¸º `garbage`ï¼Œåˆ™æŠŠè¯¥è®°å½•å‰çš„`pick`æ”¹æˆ`reword`ï¼Œå†ä¿å­˜é€€å‡ºã€‚

ç°åœ¨è¿›å…¥äº† rebase çŠ¶æ€ï¼Œé€”ä¸­å¦‚æœæœ‰å†²çªå‡ºç°äº†ï¼Œä¾¿ä¼šä¸­é€”åœæ­¢ï¼Œç­‰è§£å†³äº†å†²çª(add/rm)ï¼Œä¾¿å¯ä»¥ç»§ç»­æ‰§è¡Œ`git
rebase --continue`
