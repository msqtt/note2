# é“¾å¼æ“ä½œ

## é“¾å¼æ“ä½œ
Gorm ç»§æ‰¿äº†é“¾å¼æ“ä½œæ¥å£ï¼Œ æ‰€ä»¥ä½ å¯ä»¥å†™åƒä¸‹é¢ä¸€æ ·çš„ä»£ç ï¼š

```go
db, err := gorm.Open("postgres", "user=gorm dbname=gorm sslmode=disable")

// åˆ›å»ºä¸€ä¸ªæ–°çš„å…³ç³»
tx := db.Where("name = ?", "jinzhu")

// æ–°å¢æ›´å¤šçš„ç­›é€‰æ¡ä»¶
if someCondition {
    tx = tx.Where("age = ?", 20)
} else {
    tx = tx.Where("age = ?", 30)
}

if yetAnotherCondition {
    tx = tx.Where("active = ?", 1)
}
```
ç›´åˆ°è°ƒç”¨ç«‹å³æ–¹æ³•ä¹‹å‰éƒ½ä¸ä¼šäº§ç”ŸæŸ¥è¯¢ï¼Œåœ¨æŸäº›åœºæ™¯ä¸­ä¼šå¾ˆæœ‰ç”¨ã€‚

å°±åƒä½ å¯ä»¥å°è£…ä¸€ä¸ªåŒ…æ¥å¤„ç†ä¸€äº›å¸¸è§çš„é€»è¾‘

## åˆ›å»ºæ–¹æ³•
åˆ›å»ºæ–¹æ³•å°±æ˜¯é‚£äº›ä¼šäº§ç”Ÿ SQL æŸ¥è¯¢å¹¶ä¸”å‘é€åˆ°æ•°æ®åº“ï¼Œé€šå¸¸å®ƒå°±æ˜¯ä¸€äº› CRUD æ–¹æ³•ï¼Œ å°±åƒ:

`Create, First, Find, Take, Save, UpdateXXX, Delete, Scan, Row, Rowsâ`€¦

ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ›å»ºæ–¹æ³•çš„ä¾‹å­:

`tx.Find(&user)`

## ç”Ÿæˆ

```go
SELECT * FROM users where name = 'jinzhu' AND age = 30 AND active = 1;
Scopes æ–¹æ³•
Scope æ–¹æ³•åŸºäºé“¾å¼æ“ä½œç†è®ºåˆ›å»ºçš„ã€‚
```
ä½¿ç”¨å®ƒï¼Œä½ å¯ä»¥æå–ä¸€äº›é€šç”¨é€»è¾‘ï¼Œå†™ä¸€äº›æ›´å¯ç”¨çš„åº“ã€‚

```go
func AmountGreaterThan1000(db *gorm.DB) *gorm.DB {
    return db.Where("amount > ?", 1000)
}

func PaidWithCreditCard(db *gorm.DB) *gorm.DB {
    return db.Where("pay_mode_sign = ?", "C")
}

func PaidWithCod(db *gorm.DB) *gorm.DB {
    return db.Where("pay_mode_sign = ?", "C")
}

func OrderStatus(status []string) func (db *gorm.DB) *gorm.DB {
    return func (db *gorm.DB) *gorm.DB {
        return db.Scopes(AmountGreaterThan1000).Where("status in (?)", status)
    }
}

db.Scopes(AmountGreaterThan1000, PaidWithCreditCard).Find(&orders)
// æŸ¥æ‰¾æ‰€æœ‰å¤§äº1000çš„ä¿¡ç”¨å¡è®¢å•å’Œé‡‘é¢

db.Scopes(AmountGreaterThan1000, PaidWithCod).Find(&orders)
// æŸ¥æ‰¾æ‰€æœ‰å¤§äº1000çš„ COD è®¢å•å’Œé‡‘é¢

db.Scopes(AmountGreaterThan1000, OrderStatus([]string{"paid", "shipped"})).Find(&orders)
// æŸ¥æ‰¾å¤§äº1000çš„æ‰€æœ‰ä»˜è´¹å’Œè¿å•
```

## å¤šä¸ªåˆ›å»ºæ–¹æ³•
å½“ä½¿ç”¨ GORM çš„åˆ›å»ºæ–¹æ³•ï¼Œåé¢çš„åˆ›å»ºæ–¹æ³•å°†å¤ç”¨å‰é¢çš„åˆ›å»ºæ–¹æ³•çš„æœç´¢æ¡ä»¶ï¼ˆä¸åŒ…å«å†…è”æ¡ä»¶ï¼‰

```go
db.Where("name LIKE ?", "jinzhu%").Find(&users, "id IN (?)", []int{1, 2, 3}).Count(&count)
ç”Ÿæˆ

SELECT * FROM users WHERE name LIKE 'jinzhu%' AND id IN (1, 2, 3)

SELECT count(*) FROM users WHERE name LIKE 'jinzhu%'
```
## çº¿ç¨‹å®‰å…¨
æ‰€æœ‰çš„é“¾å¼æ“ä½œéƒ½å°†ä¼šå…‹éš†å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“å¯¹è±¡ï¼ˆå…±äº«ä¸€ä¸ªè¿æ¥æ± ï¼‰ï¼ŒGORM å¯¹äºå¤šä¸ª goroutines çš„å¹¶å‘ä½¿ç”¨æ˜¯å®‰å…¨çš„ã€‚
